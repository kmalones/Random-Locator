<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Localities</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <style>
    html {
      background: aliceblue;
    }
    #map {
      height: 80vh;
      border: 1px;
    }
    h3 {
      text-align: center;
    }
  </style>
  <body>
    <div id="map"></div>

    <div id="marker-info">
      <h3>Random Marker Localities (Refresh Page to get new Localities)</h3>
      <div id="marker1-text" class="marker-item">Marker 1: Loading...</div>
      <div id="marker2-text" class="marker-item">Marker 2: Loading...</div>
      <div id="marker3-text" class="marker-item">Marker 3: Loading...</div>
    </div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script>
      function getRandomInRange(from, to, fixed) {
        return (Math.random() * (to - from) + from).toFixed(fixed) * 1;
      }

      window.onload = function () {
        const coords = [
          {
            lat: getRandomInRange(30, 35, 3),
            lng: getRandomInRange(-90, -100, 3),
            id: 1,
          },
          {
            lat: getRandomInRange(30, 35, 3),
            lng: getRandomInRange(-90, -100, 3),
            id: 2,
          },
          {
            lat: getRandomInRange(30, 35, 3),
            lng: getRandomInRange(-90, -100, 3),
            id: 3,
          },
        ];

        const southWest = L.latLng(30, -100);
        const northEast = L.latLng(35, -90);
        const bounds = L.latLngBounds(southWest, northEast);

        const map = L.map("map");
        map.fitBounds(bounds);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "Â© OpenStreetMap contributors",
        }).addTo(map);

        async function processMarker(coord) {
          const { lat, lng, id } = coord;
          const textElement = document.getElementById(`marker${id}-text`);
          const coordsText = `<span class="coords">(${lat.toFixed(
            3
          )}, ${lng.toFixed(3)})</span>`;

          textElement.innerHTML = `Marker ${id}: ${coordsText} - **Fetching Locality...**`;

          L.marker([lat, lng])
            .addTo(map)
            .bindPopup(`Marker ${id}<br>${coordsText}`)
            .openPopup();

          try {
            const apiUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`;
            const response = await fetch(apiUrl);
            const data = await response.json();

            const locality = data.locality || data.city || "Locality Unknown";

            textElement.innerHTML = `
                        Marker ${id}: ${coordsText}<br>
                        Locality: <span class="locality">${locality}</span>
                    `;
          } catch (error) {
            console.error(`API Error for Marker ${id}:`, error);
            textElement.innerHTML = `Marker ${id}: ${coordsText}<br>Locality: <span class="locality">API Call Failed</span>`;
          }
        }

        coords.forEach(processMarker);
      };
    </script>
  </body>
</html>
